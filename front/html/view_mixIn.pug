mixin hashtag(hashtags)
    if(hashtags.length > 0)
        dd.articleHashtag
            - var hashtags = topic.hashtags.map(e => `#${e.hash}`).join(" ");
            a #{hashtags}

mixin basicInfo(author, date, view, replyCount, ident)
    - var author = 'by ' + author+ ' | '
    - var dateView = date + ' | '+view+ ' views | '
    - var replyCount = ident === 't'? replyCount + ' answers' : replyCount + ' comments'
    - var basicInfo = author + dateView + replyCount
    dd.articleBasicInfo #{basicInfo}

mixin articleContent()
    iframe(id="content" class="articleContentIframe" style="border: none;")
    script.
        const contentFrame = document.getElementById("content");
        contentFrame.width = "100%";
        const page = contentFrame.contentWindow.document;
        const content = "#{topic.content}".replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&amp;/g,'&').replace(/&quot;/g, '\"');

        window.addEventListener('DOMContentLoaded', function () {
            autoHeight();
        });

        window.addEventListener('resize', function () {
            autoHeight();
        });

        function autoHeight() {
            contentFrame.height = page.body.scrollHeight + 'px';
            const innerIFrames = Array.from(page.getElementsByTagName('iframe'));
            for (const innerIFrame of innerIFrames) {
                if (!innerIFrame.id.startsWith('embed-')) continue;

                innerIFrame.onload = function () {
                    const content = innerIFrame.contentDocument ? innerIFrame.contentDocument : innerIFrame.contentWindow.document;

                    // height of youtube iframe
                    innerIFrame.height = content.body.scrollHeight + 'px';
                    // height of content iframe
                    contentFrame.height = page.body.scrollHeight + 'px';
                }
            }
        }

        var cssLink = document.createElement("link");
        cssLink.href = "./public/b-editor/__b-editor.css";
        cssLink.rel = "stylesheet";
        cssLink.type = "text/css";
        page.head.appendChild(cssLink);

        var scriptLink = document.createElement("script")
        scriptLink.src = "./public/b-editor/__b-editor.js";
        page.head.appendChild(scriptLink);

        page.body.innerHTML = content;
        const imgTags = page.getElementsByTagName("img");
        for (const t of imgTags) {
            t.onload = () => {
                const i = document.getElementById('content');
                const w = i.contentWindow.document.body.scrollWidth;
                const h = i.contentWindow.document.body.scrollHeight;
                i.height = h;
                i.width = w;
            };
        }

mixin aritcleLikeButton(status)
    if(status)
        button(class="articleLikeButton" type="submit" id="articleLikeButton")
            img(src="icons/highlight_ed.png" class="articleLikeImage" id="likeImage")
    else
        button(class="articleLikeButton" type="submit" id="articleLikeButton")
            img(src="icons/highlight.png" class="articleLikeImage" id="likeImage")

mixin reply(type, articleId)
    if(type ==='t')
        a(href='/tandya/'+articleId+'/answer/new' class="replyInputLink") answer
    else
        textarea(name='reply' id="replyInput" class="replyInput")
        input(type='submit' value='comment' class="replyInputButton" id="replySubmitButton")

mixin articlePop(type, loginUser, articleAuthor)
    span.articleMenuSpan
        button.articleMenuButton(id="articleWarnButton")
                img.articleMenuImg(src="./icons/warn.png")
    if(loginUser === articleAuthor)
        span.articleMenuSpan
            button.articleMenuButton(id="articleDeleteButton")
                img.articleMenuImg(src="./icons/trash.png")
        if(type === 'p')
            span.articleMenuSpan
                a.articleMenuButton(href='/penobrol/edit/'+topic.id)
                    img.articleMenuImg(src="./icons/edit.png")
        else if(type === 't' )
            span.articleMenuSpan
                a.articleMenuButton(href='/tandya/edit/'+topic.id)
                    img.articleMenuImg(src="./icons/edit.png")
        else if(type === 'y')
            span.articleMenuSpan
                a.articleMenuButton(href='/youtublog/edit/' + topic.id)
                    img.articleMenuImg(src="./icons/edit.png")